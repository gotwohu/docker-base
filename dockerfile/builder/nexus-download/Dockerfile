ARG BASE_BUILDER_IMAGE
################################################################################
# Common nexus downloader image
################################################################################
FROM ${BASE_BUILDER_IMAGE} as downloader

ARG DOWNLOAD_DIR_DEFAULT=$HOME/download
ENV DOWNLOAD_DIR=$DOWNLOAD_DIR_DEFAULT

USER root
RUN set -x; \
    mkdir -m u=rwx,g=rwx,o=rx -p $DOWNLOAD_DIR && \
    chown -R $SYSTEM_USER:$SYSTEM_USER_GROUP $DOWNLOAD_DIR
USER $SYSTEM_USER

WORKDIR $DOWNLOAD_DIR

# incoming parameters
ARG NEXUS_USER
ARG NEXUS_PASSWORD
ARG NEXUS_REPOSITORY_URL
ARG NEXUS_REPOSITORY
ARG NEXUS_OBJECT_GROUP_ID
ARG NEXUS_OBJECT_ARTIFACT_ID
ARG NEXUS_OBJECT_EXTENSION
ARG NEXUS_OBJECT_VERSION
ARG NEXUS_OBJECT_CLASSIFIER
ARG NEXUS_DOWNLOAD_OUTPUT_FILE_NAME
ARG NEXUS_DOWNLOAD_OUTPUT_FILE_NAME_SHA1

ENV NEXUS_USER=$NEXUS_USER
ENV NEXUS_PASSWORD=$NEXUS_PASSWORD
ENV NEXUS_REPOSITORY_URL=$NEXUS_REPOSITORY_URL
ENV NEXUS_REPOSITORY=$NEXUS_REPOSITORY
ENV NEXUS_OBJECT_GROUP_ID=$NEXUS_OBJECT_GROUP_ID
ENV NEXUS_OBJECT_ARTIFACT_ID=$NEXUS_OBJECT_ARTIFACT_ID
ENV NEXUS_OBJECT_EXTENSION=$NEXUS_OBJECT_EXTENSION
ENV NEXUS_OBJECT_VERSION=$NEXUS_OBJECT_VERSION
ENV NEXUS_OBJECT_CLASSIFIER=$NEXUS_OBJECT_CLASSIFIER
ENV NEXUS_DOWNLOAD_OUTPUT_FILE_NAME=$NEXUS_DOWNLOAD_OUTPUT_FILE_NAME
ENV NEXUS_DOWNLOAD_OUTPUT_FILE_NAME_SHA1=$NEXUS_DOWNLOAD_OUTPUT_FILE_NAME_SHA1

COPY script/artifact/common-nexus-download.sh $HOME/script/common-nexus-download.sh
COPY script/artifact/maven-search-download.sh $HOME/script/maven-search-download.sh
COPY script/artifact/sonatype-download.sh $HOME/script/sonatype-download.sh

CMD ["sh", "-c", "$HOME/script/common-nexus-download.sh" ]

ARG BASE_BUILDER_IMAGE
LABEL base.image=$BASE_BUILDER_IMAGE
LABEL image.usage=builder
LABEL download.dir=$DOWNLOAD_DIR
